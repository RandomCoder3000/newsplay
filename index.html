<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NewsPlay — Kid‑Friendly Current Affairs Starter</title>
  <!-- Tailwind (CDN) for fast styling; safe to remove and use your own CSS later -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js for the time‑travel data chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Simple, friendly motion */
    .pop { transition: transform 120ms ease; }
    .pop:active { transform: scale(0.98); }
    .comic-panel { box-shadow: inset 0 0 0 3px rgba(0,0,0,0.06); }
  </style>
</head>
<body class="bg-gradient-to-b from-indigo-50 to-white min-h-screen text-slate-800">
  <header class="max-w-5xl mx-auto px-4 pt-6">
    <div class="flex items-center justify-between">
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">🗺️ NewsPlay <span class="text-indigo-600">Starter</span></h1>
      
    </div>
    <p class="mt-2 text-slate-600">Kid‑friendly explanations of economics & current events. Choose an age, tap a card, learn by mini‑comics 🎉</p>
  </header>

  <main class="max-w-5xl mx-auto px-4 pb-24">
    <!-- AGE SELECTOR -->
    <section class="mt-6 p-4 bg-white/70 backdrop-blur rounded-2xl shadow">
      <div class="flex items-center justify-between gap-3 flex-wrap">
        <h2 class="font-bold">Age switcher</h2>
        <div class="flex gap-2" role="tablist" aria-label="Age tiers">
          <button id="age-6-8" class="age-btn pop px-3 py-2 rounded-xl bg-indigo-600 text-white" data-tier="6_8">6–8</button>
          <button id="age-9-11" class="age-btn pop px-3 py-2 rounded-xl bg-indigo-100" data-tier="9_11">9–11</button>
          <button id="age-12-14" class="age-btn pop px-3 py-2 rounded-xl bg-indigo-100" data-tier="12_14">12–14</button>
        </div>
      </div>
      <p class="mt-2 text-sm text-slate-600">Tip: This instantly changes wording and examples everywhere.</p>
    </section>

    <!-- STORY CARD / MINI‑COMIC -->
    <section class="mt-6 grid md:grid-cols-2 gap-6">
      <article class="p-5 bg-white rounded-2xl shadow">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h3 class="text-xl font-bold" id="story-title">Why do prices change?</h3>
            <a id="story-source" class="text-xs text-indigo-600 underline" href="https://en.wikipedia.org/wiki/Inflation" target="_blank" rel="noreferrer">Source link</a>
          </div>
          <div class="flex gap-2">
            <button id="btn-tts" class="pop px-3 py-2 rounded-xl bg-emerald-600 text-white" title="Read aloud">🔊 Read aloud</button>
          </div>
        </div>

        <!-- 3‑panel mini‑comic -->
        <div class="mt-4 grid grid-cols-3 gap-3" id="comic">
          <div class="comic-panel rounded-xl bg-orange-50 p-3" id="panel-1"></div>
          <div class="comic-panel rounded-xl bg-yellow-50 p-3" id="panel-2"></div>
          <div class="comic-panel rounded-xl bg-lime-50 p-3" id="panel-3"></div>
        </div>

        <!-- Explain‑Back (voice or text) -->
        <div class="mt-5 p-3 rounded-xl bg-slate-50">
          <h4 class="font-semibold">Explain‑Back 🎤</h4>
          <p class="text-sm text-slate-600">In 15 seconds, try to explain the story in your own words! (Use the mic or type.)</p>
          <div class="mt-2 flex flex-wrap gap-2 items-center">
            <button id="btn-record" class="pop px-3 py-2 rounded-xl bg-rose-600 text-white">🎙️ Start/Stop</button>
            <span id="record-status" class="text-xs text-slate-500">Mic: idle</span>
          </div>
          <textarea id="explain-text" class="mt-2 w-full h-24 p-2 rounded-lg border" placeholder="Or type your explanation here..."></textarea>
          <button id="btn-score" class="mt-2 pop px-3 py-2 rounded-xl bg-indigo-600 text-white">✨ Get kind feedback</button>
          <p id="score-output" class="mt-2 text-sm"></p>
        </div>
      </article>

      <!-- TIME‑TRAVEL DATA (World Bank GDP per person) -->
      <aside class="p-5 bg-white rounded-2xl shadow">
        <div class="flex items-center justify-between gap-3">
          <h3 class="text-xl font-bold">Time‑Travel Data ⏳</h3>
          <div class="flex gap-2 items-center">
            <label for="country" class="text-sm">Country</label>
            <select id="country" class="border rounded-lg p-2">
              <option value="IND" selected>India</option>
              <option value="USA">United States</option>
              <option value="GBR">United Kingdom</option>
              <option value="IDN">Indonesia</option>
              <option value="BRA">Brazil</option>
            </select>
          </div>
        </div>
        <p class="text-sm text-slate-600">Indicator: GDP per person (current US$)</p>
        <canvas id="chart" class="mt-3"></canvas>
        <div class="mt-4">
          <label for="year" class="text-sm">Slide through years: <span id="year-label"></span></label>
          <input id="year" type="range" min="2000" max="2023" value="2016" class="w-full">
          <div class="text-sm mt-1">Value: <span id="year-value">—</span></div>
        </div>
      </aside>

      <!-- SECOND STORY CARD -->
      <article class="p-5 bg-white rounded-2xl shadow">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h3 class="text-xl font-bold" id="story2-title">Why do countries trade?</h3>
            <a id="story2-source" class="text-xs text-indigo-600 underline" 
               href="https://en.wikipedia.org/wiki/International_trade" target="_blank" rel="noreferrer">
              Source link
            </a>
          </div>
          <div class="flex gap-2">
            <button id="btn-tts-2" class="pop px-3 py-2 rounded-xl bg-emerald-600 text-white" title="Read aloud">🔊 Read aloud</button>
          </div>
        </div>

        <div class="mt-4 grid grid-cols-3 gap-3">
          <div class="comic-panel rounded-xl bg-sky-50 p-3" id="panel2-1"></div>
          <div class="comic-panel rounded-xl bg-cyan-50 p-3" id="panel2-2"></div>
          <div class="comic-panel rounded-xl bg-teal-50 p-3" id="panel2-3"></div>
        </div>
      </article>

      <!-- THIRD STORY CARD -->
      <article class="p-5 bg-white rounded-2xl shadow">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h3 class="text-xl font-bold" id="story3-title">How do banks work?</h3>
            <a id="story3-source" class="text-xs text-indigo-600 underline" 
               href="https://en.wikipedia.org/wiki/Bank" target="_blank" rel="noreferrer">
              Source link
            </a>
          </div>
          <div class="flex gap-2">
            <button id="btn-tts-3" class="pop px-3 py-2 rounded-xl bg-emerald-600 text-white" title="Read aloud">🔊 Read aloud</button>
          </div>
        </div>

        <div class="mt-4 grid grid-cols-3 gap-3">
          <div class="comic-panel rounded-xl bg-fuchsia-50 p-3" id="panel3-1"></div>
          <div class="comic-panel rounded-xl bg-purple-50 p-3" id="panel3-2"></div>
          <div class="comic-panel rounded-xl bg-violet-50 p-3" id="panel3-3"></div>
        </div>
      </article>

      <!-- FOURTH STORY CARD -->
      <article class="p-5 bg-white rounded-2xl shadow">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h3 class="text-xl font-bold" id="story4-title">How do taxes work?</h3>
            <a id="story4-source" class="text-xs text-indigo-600 underline" 
               href="https://en.wikipedia.org/wiki/Tax" target="_blank" rel="noreferrer">
              Source link
            </a>
          </div>
          <div class="flex gap-2">
            <button id="btn-tts-4" class="pop px-3 py-2 rounded-xl bg-emerald-600 text-white" title="Read aloud">🔊 Read aloud</button>
          </div>
        </div>

        <div class="mt-4 grid grid-cols-3 gap-3">
          <div class="comic-panel rounded-xl bg-amber-50 p-3" id="panel4-1"></div>
          <div class="comic-panel rounded-xl bg-yellow-50 p-3" id="panel4-2"></div>
          <div class="comic-panel rounded-xl bg-orange-50 p-3" id="panel4-3"></div>
        </div>
      </article>

      <!-- FIFTH STORY CARD -->
      <article class="p-5 bg-white rounded-2xl shadow">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h3 class="text-xl font-bold" id="story5-title">What is GDP?</h3>
            <a id="story5-source" class="text-xs text-indigo-600 underline" 
               href="https://en.wikipedia.org/wiki/Gross_domestic_product" target="_blank" rel="noreferrer">
              Source link
            </a>
          </div>
          <div class="flex gap-2">
            <button id="btn-tts-5" class="pop px-3 py-2 rounded-xl bg-emerald-600 text-white" title="Read aloud">🔊 Read aloud</button>
          </div>
        </div>

        <div class="mt-4 grid grid-cols-3 gap-3">
          <div class="comic-panel rounded-xl bg-emerald-50 p-3" id="panel5-1"></div>
          <div class="comic-panel rounded-xl bg-teal-50 p-3" id="panel5-2"></div>
          <div class="comic-panel rounded-xl bg-green-50 p-3" id="panel5-3"></div>
        </div>
      </article>
    </section>

    <!-- HOW‑TO PUBLISH -->
    

    <!-- FOOTER -->
    <footer class="mt-10 text-center text-xs text-slate-500">
      <p>Built for kids. No ads, no trackers. You own your data on this page.</p>
    </footer>
  </main>

  <script>
    /******************
     * 1) AGE‑ADAPTIVE STORY CONTENT
     ******************/
    const story = {
      title: "Why do prices change?",
      panels: {
        "6_8": [
          "🍌 Panel 1: Your banana costs 10 coins yesterday.",
          "🏪 Panel 2: Storms hurt farms. Fewer bananas arrive.",
          "💡 Panel 3: With less bananas, shops raise prices. This is called price rise."
        ],
        "9_11": [
          "📈 When many people want an item but fewer are available, the price often goes up.",
          "🌧️ Bad weather or higher fuel costs can make it harder to bring goods to shops.",
          "🧠 This price increase across many things is called inflation."
        ],
        "12_14": [
          "🔍 Prices change with supply and demand. Lower supply or higher demand pushes prices up.",
          "⛽ Transport and energy costs also ripple into final prices you see.",
          "🧮 When average prices rise broadly over time, that’s inflation (often tracked by CPI)."
        ]
      },
      source: "https://en.wikipedia.org/wiki/Inflation"
    };

    const story2 = {
      title: "Why do countries trade?",
      panels: {
        "6_8": [
          "🌾 Panel 1: One country grows lots of rice. Another makes great toys.",
          "🚢 Panel 2: They swap—rice for toys—so both have what they need.",
          "🤝 Panel 3: Trading helps people get more choices at good prices."
        ],
        "9_11": [
          "📦 Countries trade when each can make some things easier or cheaper.",
          "💱 Swapping (import/export) means more variety and sometimes lower prices.",
          "🧠 This idea is called specialization—do what you’re best at, trade for the rest."
        ],
        "12_14": [
          "⚖️ Trade is driven by comparative advantage—produce where opportunity cost is lowest.",
          "🌍 Imports/exports increase variety, efficiency, and can lower average prices.",
          "🧭 Downsides can include job shifts or dependence; policies try to balance these."
        ]
      },
      source: "https://en.wikipedia.org/wiki/International_trade"
    };

    function renderStory2() {
      document.getElementById('story2-title').textContent = story2.title;
      document.getElementById('story2-source').href = story2.source;
      const panels = story2.panels[currentTier];
      document.getElementById('panel2-1').textContent = panels[0];
      document.getElementById('panel2-2').textContent = panels[1];
      document.getElementById('panel2-3').textContent = panels[2];
    }

    // Second card Text-to-Speech
    (function(){
      const btn2 = document.getElementById('btn-tts-2');
      if (btn2) {
        btn2.addEventListener('click', () => {
          const text = story2.panels[currentTier].join(' ');
          if (!('speechSynthesis' in window)) { alert('Text-to-Speech not supported in this browser.'); return; }
          const utter = new SpeechSynthesisUtterance(text);
          utter.rate = currentTier === '6_8' ? 0.9 : 1;
          speechSynthesis.cancel();
          speechSynthesis.speak(utter);
        });
      }
    })();

    const story3 = {
      title: "How do banks work?",
      panels: {
        "6_8": [
          "🏦 Panel 1: People put money in a bank to keep it safe.",
          "💸 Panel 2: The bank keeps some money and lends the rest to people and businesses.",
          "➕ Panel 3: Loans are paid back later with a little extra called interest."
        ],
        "9_11": [
          "📥 Banks hold deposits and use part of them to make loans.",
          "📈 Borrowers pay interest; savers may earn a smaller interest.",
          "🛡️ Rules make banks keep a safe reserve so people can withdraw cash."
        ],
        "12_14": [
          "📊 Banks take deposits (liabilities) and make loans (assets); lending can create new deposit money.",
          "💱 Interest is the price of borrowing; the spread between loan and deposit rates is income.",
          "🏛️ Central banks influence rates/reserves; risk controls help prevent bank runs."
        ]
      },
      source: "https://en.wikipedia.org/wiki/Bank"
    };

    function renderStory3() {
      document.getElementById('story3-title').textContent = story3.title;
      document.getElementById('story3-source').href = story3.source;
      const panels = story3.panels[currentTier];
      document.getElementById('panel3-1').textContent = panels[0];
      document.getElementById('panel3-2').textContent = panels[1];
      document.getElementById('panel3-3').textContent = panels[2];
    }

    // Third card Text-to-Speech
    (function(){
      const btn3 = document.getElementById('btn-tts-3');
      if (btn3) {
        btn3.addEventListener('click', () => {
          const text = story3.panels[currentTier].join(' ');
          if (!('speechSynthesis' in window)) { alert('Text-to-Speech not supported in this browser.'); return; }
          const utter = new SpeechSynthesisUtterance(text);
          utter.rate = currentTier === '6_8' ? 0.9 : 1;
          speechSynthesis.cancel();
          speechSynthesis.speak(utter);
        });
      }
    })();

    const story4 = {
      title: "How do taxes work?",
      panels: {
        "6_8": [
          "🧾 Panel 1: Grown‑ups and shops pay a small part of money called tax.",
          "🚒 Panel 2: This money helps pay for roads, schools, parks, and helpers like firefighters.",
          "🤝 Panel 3: Everyone giving a little means the whole town can share big things."
        ],
        "9_11": [
          "🏫 Taxes are money collected by the government to fund public services—schools, hospitals, roads.",
          "🧮 Some taxes are on income, some on things you buy (sales tax/GST).",
          "⚖️ Different countries choose different rates and rules to try to be fair."
        ],
        "12_14": [
          "📚 Taxes fund public goods and transfers. Main types: income, corporate, consumption (VAT/GST), property.",
          "📊 Systems can be progressive, proportional, or regressive; policy balances revenue, equity, and incentives.",
          "🌐 Compliance and enforcement matter; budgets decide how tax money is allocated."
        ]
      },
      source: "https://en.wikipedia.org/wiki/Tax"
    };

    function renderStory4() {
      document.getElementById('story4-title').textContent = story4.title;
      document.getElementById('story4-source').href = story4.source;
      const panels = story4.panels[currentTier];
      document.getElementById('panel4-1').textContent = panels[0];
      document.getElementById('panel4-2').textContent = panels[1];
      document.getElementById('panel4-3').textContent = panels[2];
    }

    (function(){
      const btn4 = document.getElementById('btn-tts-4');
      if (btn4) {
        btn4.addEventListener('click', () => {
          const text = story4.panels[currentTier].join(' ');
          if (!('speechSynthesis' in window)) { alert('Text-to-Speech not supported in this browser.'); return; }
          const utter = new SpeechSynthesisUtterance(text);
          utter.rate = currentTier === '6_8' ? 0.9 : 1;
          speechSynthesis.cancel();
          speechSynthesis.speak(utter);
        });
      }
    })();

    const story5 = {
      title: "What is GDP?",
      panels: {
        "6_8": [
          "🏭 Panel 1: Imagine adding up all the things a country makes in a year.",
          "🧮 Panel 2: That big total is called GDP—it shows how busy the country’s economy is.",
          "📈 Panel 3: If GDP grows, people are making more stuff and services."
        ],
        "9_11": [
          "🧰 GDP is the value of goods and services made in a country in one year.",
          "🔁 It can grow or shrink; we compare years to see change.",
          "👥 GDP per person divides GDP by the number of people to compare countries."
        ],
        "12_14": [
          "🧮 GDP measures market value of final goods/services within borders over a period (often real vs nominal).",
          "📊 It’s tracked by components: consumption, investment, government spending, and net exports (C+I+G+NX).",
          "⚠️ Limits: doesn’t capture inequality, unpaid work, or environmental costs."
        ]
      },
      source: "https://en.wikipedia.org/wiki/Gross_domestic_product"
    };

    function renderStory5() {
      document.getElementById('story5-title').textContent = story5.title;
      document.getElementById('story5-source').href = story5.source;
      const panels = story5.panels[currentTier];
      document.getElementById('panel5-1').textContent = panels[0];
      document.getElementById('panel5-2').textContent = panels[1];
      document.getElementById('panel5-3').textContent = panels[2];
    }

    (function(){
      const btn5 = document.getElementById('btn-tts-5');
      if (btn5) {
        btn5.addEventListener('click', () => {
          const text = story5.panels[currentTier].join(' ');
          if (!('speechSynthesis' in window)) { alert('Text-to-Speech not supported in this browser.'); return; }
          const utter = new SpeechSynthesisUtterance(text);
          utter.rate = currentTier === '6_8' ? 0.9 : 1;
          speechSynthesis.cancel();
          speechSynthesis.speak(utter);
        });
      }
    })();

    let currentTier = "6_8";

    function renderStory() {
      document.getElementById('story-title').textContent = story.title;
      document.getElementById('story-source').href = story.source;
      const panels = story.panels[currentTier];
      for (let i = 0; i < 3; i++) {
        document.getElementById(`panel-${i+1}`).textContent = panels[i];
      }
    }

    // Age switcher
    document.querySelectorAll('.age-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.age-btn').forEach(b => b.className = 'age-btn pop px-3 py-2 rounded-xl bg-indigo-100');
        btn.className = 'age-btn pop px-3 py-2 rounded-xl bg-indigo-600 text-white';
        currentTier = btn.dataset.tier;
        renderStory();
    if (typeof renderStory2 === 'function') renderStory2();
    if (typeof renderStory3 === 'function') renderStory3();
    if (typeof renderStory4 === 'function') renderStory4();
    if (typeof renderStory5 === 'function') renderStory5();
      });
    });

    // Text‑to‑Speech (browser Web Speech API)
    document.getElementById('btn-tts').addEventListener('click', () => {
      const text = story.panels[currentTier].join(' ');
      if (!('speechSynthesis' in window)) {
        alert('Text‑to‑Speech not supported in this browser.');
        return;
      }
      const utter = new SpeechSynthesisUtterance(text);
      utter.rate = currentTier === '6_8' ? 0.9 : 1;
      speechSynthesis.cancel();
      speechSynthesis.speak(utter);
    });

    // Explain‑Back — simple kindness scorer (on‑device; no AI key needed)
    document.getElementById('btn-score').addEventListener('click', () => {
      const t = document.getElementById('explain-text').value.trim();
      const out = document.getElementById('score-output');
      if (t.length < 20) {
        out.textContent = 'Nice start! Try adding 1) what changed, 2) why it changed, 3) the word inflation.';
        return;
      }
      let points = 1;
      if (/price|prices/i.test(t)) points++;
      if (/supply|demand/i.test(t)) points++;
      if (/inflation/i.test(t)) points++;
      const messages = {
        1: 'Great effort! Try to mention prices and why they changed.',
        2: 'Good! You noticed prices changed. Can you add supply or demand?',
        3: 'Strong! You used key ideas. One more detail would make it excellent.',
        4: 'Excellent explanation! You covered the big ideas 🎉'
      };
      out.textContent = messages[Math.min(points,4)];
    });

    // Optional: voice to text (only in some browsers)
    let recognizing = false;
    let recognition;
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.lang = 'en-US';
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onstart = () => { document.getElementById('record-status').textContent = 'Mic: recording…'; };
      recognition.onend = () => { recognizing = false; document.getElementById('record-status').textContent = 'Mic: stopped'; };
      recognition.onresult = (e) => {
        const transcript = Array.from(e.results).map(r => r[0].transcript).join(' ');
        document.getElementById('explain-text').value = transcript;
      };
    }

    document.getElementById('btn-record').addEventListener('click', async () => {
      if (!recognition) { alert('Speech recognition not supported here. You can type instead!'); return; }
      if (!recognizing) { recognizing = true; recognition.start(); } else { recognition.stop(); }
    });

    renderStory();
    if (typeof renderStory2 === 'function') renderStory2();
    if (typeof renderStory3 === 'function') renderStory3();
    if (typeof renderStory4 === 'function') renderStory4();
    if (typeof renderStory5 === 'function') renderStory5();

    /******************
     * 2) WORLD BANK DATA CHART (GDP per capita) — no API key needed
     ******************/
    const chartCtx = document.getElementById('chart');
    let chart;

    async function fetchGDPpc(country3 = 'IND') {
      // World Bank API: indicator NY.GDP.PCAP.CD, format=json, per page=20000 to get all years
      const url = `https://api.worldbank.org/v2/country/${country3}/indicator/NY.GDP.PCAP.CD?format=json&per_page=20000`;
      const res = await fetch(url);
      const data = await res.json();
      // data[1] has an array sorted newest→oldest; we’ll collect 2000–2023
      const rows = (data[1] || []).filter(r => r.date >= '2000' && r.date <= '2023').reverse();
      const years = rows.map(r => +r.date);
      const values = rows.map(r => (r.value == null ? null : Math.round(r.value)));
      return { years, values };
    }

    function renderChart(years, values) {
      if (chart) chart.destroy();
      chart = new Chart(chartCtx, {
        type: 'line',
        data: { labels: years, datasets: [{ label: 'GDP per person (US$)', data: values, tension: 0.25, pointRadius: 2 }] },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { x: { grid: { display: false } }, y: { ticks: { callback: (v)=>'$'+v.toLocaleString() } } }
        }
      });
    }

    async function loadCountry(c) {
      const { years, values } = await fetchGDPpc(c);
      renderChart(years, values);
      const yearInput = document.getElementById('year');
      const yearLabel = document.getElementById('year-label');
      const yearValue = document.getElementById('year-value');
      yearInput.min = years[0];
      yearInput.max = years[years.length - 1];
      yearInput.value = years[Math.floor(years.length/2)];

      function updateFromSlider() {
        const y = +yearInput.value;
        yearLabel.textContent = y;
        const idx = years.indexOf(y);
        const v = values[idx];
        yearValue.textContent = (v ? '$' + v.toLocaleString() : 'No data');
      }
      yearInput.oninput = updateFromSlider;
      updateFromSlider();
    }

    document.getElementById('country').addEventListener('change', (e)=> loadCountry(e.target.value));
    loadCountry('IND');
  </script>
</body>
</html>
